[← Back to README](../README.md)

# Configuration guide

Edit `${ARRCONF_DIR}/userr.conf` to control how the installer renders `.env`, `docker-compose.yml`, and helper files. `.env` now comes from `.env.template` via `scripts/gen-env.sh`, so the template is the single source of truth for Compose variables. `ARR_DATA_ROOT` defaults to `~/srv`, so generated files land under `~/srv/arr` unless you override the path. `./arr.sh` copies any exported environment variables, locks them read-only while your config loads, then reapplies them so CLI overrides always win. Before reading the file the installer looks for the first `userr.conf` under `${ARR_DATA_ROOT}` (depth 4) and then above the repo (for example `../userr.conf`). The chosen path appears in the preview table so you can confirm it.

## Prerequisites

- Ensure `envsubst` is available (Debian/Ubuntu: `sudo apt-get install -y gettext-base`; Alpine: `apk add gettext`).

## Configuration layers

1. **CLI flags** – run-scoped toggles (for example `./arr.sh --enable-caddy`) apply after the read-only guard. They override exported variables and `userr.conf`, so use them for temporary changes.
2. **Shell environment** – anything exported before running `./arr.sh` still overrides `userr.conf` and defaults, but CLI flags are applied last. Paths like `ARR_USERCONF_PATH` may be normalised to an absolute path while loading.
3. **`${ARRCONF_DIR}/userr.conf`** – your saved settings (defaults to `${ARR_DATA_ROOT}/${STACK}configs/userr.conf`). Keep it outside version control and rerun the installer after every edit.
4. **`arrconf/userr.conf.defaults.sh`** – repo defaults.

The installer prints a configuration table during preflight. Cancel with `Ctrl+C` if a value looks wrong, adjust `userr.conf`, and rerun.

## Core settings to review

### Network

| Setting | Default | Notes |
| --- | --- | --- |
| `LAN_IP` | *(empty)* | Set to your host's LAN address before exposing ports so published services bind correctly. |
| `LOCALHOST_IP` | `127.0.0.1` | Keep on loopback so health checks reach the Gluetun control API. |
| `LAN_DOMAIN_SUFFIX` | `home.arpa` | Optional hostname suffix used by local DNS and Caddy URLs. |
| `SPLIT_VPN` | `0` | `1` routes only qBittorrent through Gluetun; `0` tunnels the whole stack. |
| `EXPOSE_DIRECT_PORTS` | `1` | Leave enabled for simple `http://${LAN_IP}:PORT` access; set `0` to hide UIs behind Docker networking. |
| `DNS_DISTRIBUTION_MODE` | `router` | Choose `router` to push DNS via DHCP Option 6 or `per-device` to configure each client manually. |
| `ARR_PORT_CHECK_MODE` | `enforce` | Controls port conflict handling: `enforce`, `warn`, `skip`, or `fix` (attempt to clear blockers then warn). |

### Paths & storage

| Setting | Default | Notes |
| --- | --- | --- |
| `ARR_DATA_ROOT` | `${HOME}/srv` | Base directory; override before first run to relocate the entire stack. |
| `ARR_STACK_DIR` | `${ARR_DATA_ROOT}/${STACK}` | Working tree for compose files, scripts, and helpers. |
| `ARRCONF_DIR` | `${ARR_DATA_ROOT}/${STACK}configs` | Stores Proton credentials and overrides sourced during install. |
| `ARR_DOCKER_DIR` | `${ARR_STACK_DIR}/dockarr` | Root for per-service volumes such as `${ARR_DOCKER_DIR}/qbittorrent`. |
| `ARR_LOG_DIR` | `${ARR_STACK_DIR}/logs` | Installer logs, Compose validation output, VPN reconnect history. |
| `DOWNLOADS_DIR` | `${HOME}/Downloads` | Active download location for qBittorrent. |
| `COMPLETED_DIR` | `${DOWNLOADS_DIR}/completed` | Destination for finished downloads. |
| `MEDIA_DIR` | `${ARR_DATA_ROOT}/media` | Library root used by Sonarr/Radarr/Bazarr. |
| `TV_DIR` | `${MEDIA_DIR}/Shows` | Default Sonarr library path. |
| `MOVIES_DIR` | `${MEDIA_DIR}/Movies` | Default Radarr library path. |
| `SUBS_DIR` | `${MEDIA_DIR}/subs` | Optional Bazarr subtitles directory. |

Changing `ARR_DOCKER_DIR` moves all service state directories. Rerun `./arr.sh --yes` after editing `userr.conf` so compose, hooks, and helpers pick up the new location. Adjust `ARR_STACK_DIR`, `ARRCONF_DIR`, or `ARR_LOG_DIR` similarly to relocate the working tree, configuration, or logs.

### Credentials & preservation

| Setting | Default | Notes |
| --- | --- | --- |
| `QBT_USER` / `QBT_PASS` | `admin` / `adminadmin` | Keep credentials in sync with the WebUI; rerun the installer so `.env` updates. |
| `GLUETUN_API_KEY` | *(empty)* | Leave blank to auto-generate; helpers rotate it when missing. |
| `CADDY_BASIC_AUTH_USER` | `user` | Username required outside `CADDY_LAN_CIDRS`; hash updates follow automatically. |
| `CADDY_BASIC_AUTH_HASH` | *(empty)* | Stored in `.env`; regenerated by the installer when blank. |
| `QBT_AUTH_WHITELIST` | `127.0.0.1/32,${LAN_IP}/32` (derived) | CIDRs allowed to bypass the qBittorrent login; LAN defaults apply automatically. |

### VPN automation

| Setting | Default | Notes |
| --- | --- | --- |
| `VPN_AUTO_RECONNECT_ENABLED` | `0` | Enables the reconnect worker that monitors qBittorrent throughput. |
| `VPN_SPEED_THRESHOLD_KBPS` | `12` | Trigger reconnects when sustained speeds drop below this value. |
| `VPN_CHECK_INTERVAL_MINUTES` | `20` | Minutes between throughput samples. |
| `VPN_CONSECUTIVE_CHECKS` | `3` | Required failing samples before reconnecting. |
| `VPN_ALLOWED_HOURS_START` / `VPN_ALLOWED_HOURS_END` | *(empty)* | Restrict reconnects to a specific window; identical values allow 24/7 operation. |

### Permission profiles

| Setting | Default | Notes |
| --- | --- | --- |
| `ARR_PERMISSION_PROFILE` | `strict` | `strict` keeps secrets at `600` and data at `700`; `collab` enables group write access. |
| `ARR_UMASK_OVERRIDE` | *(empty)* | Advanced override for `umask`; inherit from the active profile when unset. |
| `ARR_DATA_DIR_MODE_OVERRIDE` | *(empty)* | Override directory mode used for data paths. |
| `ARR_NONSECRET_FILE_MODE_OVERRIDE` | *(empty)* | Override mode for non-secret files emitted during install. |
| `ARR_SECRET_FILE_MODE_OVERRIDE` | *(empty)* | Override mode for secret files such as `.env`. |

## Working with overrides / Verify resolved values

1. Edit `${ARRCONF_DIR}/userr.conf` (or the path from `ARR_USERCONF_PATH`).
2. Save the file and rerun:
   ```bash
   ./arr.sh --yes
   # Cancel before container startup if the preview looks wrong.
   ```

3. Review the summary. Never edit generated files (`.env`, `docker-compose.yml`, `Caddyfile`) by hand.
4. Confirm preserved secrets remain in sync:
  ```bash
  grep -E '^QBT_(USER|PASS)=' .env
  ```

## Optional services and containers

Toggle these extras in `${ARRCONF_DIR}/userr.conf` or via the matching `./arr.sh` flags. Rerun the installer after every change so generated files and helper aliases stay in sync.

### Caddy HTTPS proxy
- Set `ENABLE_CADDY=1` or run `./arr.sh --enable-caddy --yes` for a one-off enable.
- Caddy publishes HTTPS on `CADDY_HTTP_PORT`/`CADDY_HTTPS_PORT` (defaults 80/443) and serves hostnames like `https://qbittorrent.${LAN_DOMAIN_SUFFIX}`.
- Fetch the root certificate once and import it on each device. See [Networking](networking.md#local-https-via-caddy-optional) for the certificate flow.

### Local DNS resolver
- Set `ENABLE_LOCAL_DNS=1` to request the dnsmasq container. The installer records the real outcome in `LOCAL_DNS_STATE` and `LOCAL_DNS_STATE_REASON` so you know if another service blocked port 53.
- Free the host resolver port with `./scripts/host-dns-setup.sh` when required, then rerun the installer.
- Client setup guidance lives in [Networking](networking.md#local-dns-optional).

### Configarr automation
- Set `ENABLE_CONFIGARR=1` to let Configarr push opinionated defaults into Sonarr and Radarr.
- Keep `GLUETUN_API_KEY`, Sonarr, Radarr, and Prowlarr API keys current; `./arr.sh --sync-api-keys` recopies them into Configarr.
- Disable for a run with `./arr.sh --no-auto-api-sync` if you need to make manual adjustments temporarily.

### SABnzbd downloader
- Set `SABNZBD_ENABLED=1` (or run `./arr.sh --enable-sab --yes`) to add SABnzbd to the compose file and copy `scripts/sab-helper.sh` into the stack directory.
- Choose where SAB runs with `SABNZBD_USE_VPN` (`0` keeps it on the LAN, `1` shares Gluetun). [Networking](networking.md#sabnzbd-network-placements) shows the available modes and how ports map when qBittorrent sits inside Gluetun.
- Adjust ports with `SABNZBD_PORT` (host) and `SABNZBD_INT_PORT` (container). Leave the internal port at 8080 when SAB shares the VPN namespace so it does not clash with qBittorrent’s WebUI (`8082`).
- `SABNZBD_HOST`, `SABNZBD_TIMEOUT`, and `SABNZBD_CATEGORY` tune helper defaults. Override `SABNZBD_IMAGE` if you need a specific container tag.
- The installer preserves your API key. If `.env` still shows `REPLACE_WITH_SABNZBD_API_KEY`, reruns extract `api_key` from `sabnzbd.ini`, store a dated backup, and write the new value.
- When SAB runs on the LAN and Caddy is enabled, the stack publishes `https://sabnzbd.${LAN_DOMAIN_SUFFIX}` automatically. VPN mode skips LAN mappings, so reach it through Gluetun instead.
- Use the helper commands described in [Operations](operations.md#sabnzbd-helper) to submit jobs or check status.

### VueTorrent WebUI (qBittorrent alternative)
- Leave qBittorrent on the default LinuxServer image to use the built-in VueTorrent mod. The installer reports the active mode in its summary.
- For the standalone VueTorrent build, set `QBT_DOCKER_MODS=` empty and enable manual mode variables such as `VUETORRENT_DOWNLOAD_URL`, `VUETORRENT_SHA256`, and `VUETORRENT_MODE=manual` before rerunning the installer.
- Troubleshooting tips live in [Troubleshooting](troubleshooting.md#vuetorrent-shows-http-500-or-blank-page).

## Related topics
- [Operations](operations.md) – helper scripts and command-line flags.
- [Networking](networking.md) – VPN, DNS, and HTTPS considerations.
- [Security](security.md) – exposure and credential hygiene guidance.
